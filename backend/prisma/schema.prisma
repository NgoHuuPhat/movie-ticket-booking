
generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model LOAINGUOIDUNG {
  maLoaiNguoiDung  String @id
  tenLoaiNguoiDung String   
  moTa             String?  
  
  nguoiDungs       NGUOIDUNG[]
  dieuKienKhuyenMais DIEUKIENKHUYENMAI[]
}

enum GIOITINH {
  Nam
  Nu
  Khac
}
model NGUOIDUNG {
  maNguoiDung   String  @id 
  hoTen         String           
  email         String  @unique
  matKhau       String           
  soDienThoai   String  @unique
  maLoaiNguoiDung String         
  ngaySinh      DateTime 
  gioiTinh      GIOITINH        
  hoatDong      Boolean   @default(true)      
  ngayTao       DateTime  @default(now())
  diemTichLuy   Int @default(0)

  hoaDonNguoiMuas    HOADON[]   @relation("HoaDonNguoiMua")
  hoaDonNhanVienBans HOADON[] @relation("HoaDonNhanVienBanVe")
  lichLamViecs      LICHLAMVIEC[]

  loaiNguoiDung LOAINGUOIDUNG   @relation(fields: [maLoaiNguoiDung], references: [maLoaiNguoiDung])
}

model CALAM {
  maCaLam    String        @id
  tenCaLam   String
  gioBatDau  DateTime      @db.Time
  gioKetThuc DateTime      @db.Time

  lichLamViecs LICHLAMVIEC[]
}

enum VITRILAM {
  NhanVienBanVe
  NhanVienSoatVe
  NhanVienSoatBapNuoc
}

model LICHLAMVIEC {
  maNhanVien   String      
  maCaLam      String
  ngayLam      DateTime   @db.Date
  viTriLam     VITRILAM

  nguoiDung    NGUOIDUNG  @relation(fields: [maNhanVien], references: [maNguoiDung])
  caLam        CALAM      @relation(fields: [maCaLam], references: [maCaLam])

  @@id([maNhanVien, maCaLam, ngayLam])
}

model THELOAI {
  maTheLoai String @id
  tenTheLoai String
  
  phimTheLoais PHIM_THELOAI[]
}

model PHIM_THELOAI {
  maPhim     String
  maTheLoai  String

  phim       PHIM      @relation(fields: [maPhim], references: [maPhim], onDelete: Cascade)
  theLoai    THELOAI   @relation(fields: [maTheLoai], references: [maTheLoai], onDelete: Cascade)

  @@id([maPhim, maTheLoai])
}

model PHANLOAIDOTUOI {
  maPhanLoaiDoTuoi String @id
  tenPhanLoaiDoTuoi String
  moTa              String
  phims             PHIM[] 
}

enum PHIENBAN {
  TWO_D
  THREE_D 
}
enum NGONNGU {
  LongTieng 
  PhuDe
}
model PHIM {
  maPhim        String      @id
  tenPhim       String      
  daoDien       String
  dienVien      String
  thoiLuong     Int
  moTa          String      
  anhBia        String      
  ngayKhoiChieu DateTime   @db.Date 
  ngayKetThuc   DateTime   @db.Date
  maPhanLoaiDoTuoi String
  trailerPhim   String
  quocGia       String
  phienBan      PHIENBAN
  ngonNgu       NGONNGU
  hienThi       Boolean     @default(true)
  slug          String      @unique

  phanLoaiDoTuoi  PHANLOAIDOTUOI @relation(fields: [maPhanLoaiDoTuoi], references: [maPhanLoaiDoTuoi])

  suatChieus    SUATCHIEU[]
  phimTheLoais  PHIM_THELOAI[]
}   

model RAP {
  maRap       String    @id
  tenRap      String
  diaChi      String
  soDienThoai String
  email       String    @unique
  phongChieus PHONGCHIEU[]
}

model PHONGCHIEU {
  maPhong         String   @id
  tenPhong        String
  maLoaiPhong     String
  maRap           String
  hoatDong         Boolean  @default(true)

  loaiPhongChieu  LOAIPHONGCHIEU @relation(fields: [maLoaiPhong], references: [maLoaiPhong])
  rap             RAP            @relation(fields: [maRap], references: [maRap])

  suatChieus      SUATCHIEU[]
  ghes            GHE[]
}

model LOAIPHONGCHIEU {
  maLoaiPhong   String  @id
  tenLoaiPhong  String
  moTa          String?

  phongChieus   PHONGCHIEU[]
  giaGhePhongs  GIAGHEPHONG[]
}

model SUATCHIEU {
  maSuatChieu   String    @id
  maPhim        String
  maPhong       String
  gioBatDau     DateTime  
  gioKetThuc    DateTime  
  hoatDong      Boolean   @default(true)

  gheSuatChieus GHE_SUATCHIEU[]

  phim          PHIM        @relation(fields: [maPhim], references: [maPhim])
  phongChieu    PHONGCHIEU  @relation(fields: [maPhong], references: [maPhong])
}

model GIAGHEPHONG {
  maLoaiPhong   String  
  maLoaiGhe     String
  giaTien       Decimal      @db.Decimal(10, 2)   

  loaiGhe       LOAIGHE      @relation(fields: [maLoaiGhe], references: [maLoaiGhe])
  loaiPhongChieu LOAIPHONGCHIEU @relation(fields: [maLoaiPhong], references: [maLoaiPhong])

  @@id([maLoaiPhong, maLoaiGhe])
}

model LOAIGHE {
  maLoaiGhe   String  @id
  tenLoaiGhe  String
  moTa        String? 

  giaGhePhongs GIAGHEPHONG[]
  ghes         GHE[]
}

model GHE {
  maGhe       String  @id
  maPhong     String
  hangGhe     String
  soGhe       Int
  maLoaiGhe   String
  hoatDong    Boolean  @default(true)

  gheSuatChieus GHE_SUATCHIEU[]

  loaiGhe     LOAIGHE      @relation(fields: [maLoaiGhe], references: [maLoaiGhe])
  phongChieu  PHONGCHIEU  @relation(fields: [maPhong], references: [maPhong])
}

enum TRANGTHAIGHE {
  KhongSuDung
  DangTrong
  DaDat
}

model GHE_SUATCHIEU {
  maGheSuatChieu  String  @id
  maGhe           String  
  maSuatChieu     String
  trangThaiGhe    TRANGTHAIGHE @default(DangTrong)

  ghe             GHE         @relation(fields: [maGhe], references: [maGhe])
  suatChieu       SUATCHIEU   @relation(fields: [maSuatChieu], references: [maSuatChieu])
  ve              VE?

  @@unique([maGhe, maSuatChieu])
}

model DANHMUCSANPHAM {
  maDanhMucSanPham   String   @id
  tenDanhMucSanPham  String
  
  sanPhams           SANPHAM[]
}

model SANPHAM {
  maSanPham   String    @id
  tenSanPham  String
  giaTien     Decimal      @db.Decimal(10, 2)
  anhSanPham  String
  hienThi     Boolean   @default(true)
  maDanhMucSanPham  String

  chiTietCombos        CHITIETCOMBO[]
  hoaDonSanPhams       HOADON_SANPHAM[]

  danhMucSanPham   DANHMUCSANPHAM  @relation(fields: [maDanhMucSanPham], references: [maDanhMucSanPham])
}

model CHITIETCOMBO {
  maCombo        String
  maSanPham      String
  soLuong        Int      

  combo          COMBO     @relation(fields: [maCombo], references: [maCombo], onDelete: Cascade)
  sanPham        SANPHAM   @relation(fields: [maSanPham], references: [maSanPham], onDelete: Cascade)

  @@id([maCombo, maSanPham])
}

model COMBO {
  maCombo       String   @id
  tenCombo      String
  anhCombo      String
  giaGoc        Decimal      @db.Decimal(10, 2)   
  giaBan        Decimal      @db.Decimal(10, 2)   
  hienThi       Boolean   @default(true)

  chiTietCombos CHITIETCOMBO[]
  hoaDonCombos  HOADON_COMBO[]
}

model DIEUKIENKHUYENMAI {
  maDieuKien      String  @id
  tenLoaiDieuKien String 
  maLoaiNguoiDung String?
  moTa            String?

  loaiNguoiDung   LOAINGUOIDUNG? @relation(fields: [maLoaiNguoiDung], references: [maLoaiNguoiDung])
  khuyenMais      KHUYENMAI[]
}

enum LOAIKHUYENMAI {
  GiamGiaTien
  GiamPhanTram
}

model KHUYENMAI {
  maKhuyenMai              String   @id
  tenKhuyenMai             String
  maCode                   String   @unique
  maDieuKien               String
  loaiKhuyenMai            LOAIKHUYENMAI
  giaTriGiam               Int
  soLuong                  Int?
  soLuongDaDung            Int      @default(0)
  thangApDung              Int?
  ngayApDung               Int?
  ngayBatDau               DateTime
  ngayKetThuc              DateTime
  hoatDong                 Boolean   @default(true)
  moTa                     String?

  hoaDons                  HOADON[]

  dieuKienKhuyenMai        DIEUKIENKHUYENMAI @relation(fields: [maDieuKien], references: [maDieuKien])
}

enum HINHTHUCVE {
  Offline
  Online
}

enum PHUONGTHUCTHANHTOAN {
  VNPAY
  MOMO
  TIENMAT
}

enum TRANGTHAIVE {
  DaCheckIn
  DaThanhToan
}

model HOADON {
  maHoaDon            String   @id
  maQR                String   @unique

  maNguoiDung         String?
  maNhanVienBanVe     String?
  
  maGiaoDich          String?      @unique
  maKhuyenMai         String?
  tongTien            Decimal      @db.Decimal(10, 2)
  phuongThucThanhToan PHUONGTHUCTHANHTOAN
  ngayThanhToan       DateTime     @default(now())

  nguoiDung           NGUOIDUNG?   @relation("HoaDonNguoiMua", fields: [maNguoiDung], references: [maNguoiDung]) 
  nhanVienBanVe       NGUOIDUNG?   @relation("HoaDonNhanVienBanVe", fields: [maNhanVienBanVe], references: [maNguoiDung])
  khuyenMai           KHUYENMAI?   @relation(fields: [maKhuyenMai], references: [maKhuyenMai])

  hoaDonCombos        HOADON_COMBO[]
  hoaDonSanPhams      HOADON_SANPHAM[]
  ves                 VE[]
}

model VE {
  maVe                String   @id
  maGheSuatChieu      String   @unique
  maHoaDon            String

  giaVe               Decimal      @db.Decimal(10, 2)   
  thoiGianCheckIn     DateTime?
  
  trangThai           TRANGTHAIVE  @default(DaThanhToan)

  hoaDon              HOADON       @relation(fields: [maHoaDon], references: [maHoaDon])
  gheSuatChieu        GHE_SUATCHIEU @relation(fields: [maGheSuatChieu], references: [maGheSuatChieu])
}

model HOADON_COMBO {
  maHoaDon              String
  maCombo               String
  soLuong               Int
  donGia                Decimal      @db.Decimal(10, 2)
  tongTien              Decimal      @db.Decimal(10, 2)
          
  daLay                 Boolean      @default(false)
  thoiGianLay           DateTime?

  @@id([maHoaDon, maCombo])

  hoaDon              HOADON  @relation(fields: [maHoaDon], references: [maHoaDon], onDelete: Cascade)
  combo               COMBO  @relation(fields: [maCombo], references: [maCombo], onDelete: Cascade)
}

model HOADON_SANPHAM {
  maHoaDon              String
  maSanPham             String
  soLuong               Int
  donGia                Decimal      @db.Decimal(10, 2)
  tongTien              Decimal      @db.Decimal(10, 2)
          
  daLay                 Boolean  @default(false)
  thoiGianLay           DateTime?

  @@id([maHoaDon, maSanPham])

  hoaDon              HOADON  @relation(fields: [maHoaDon], references: [maHoaDon], onDelete: Cascade)
  sanPham             SANPHAM @relation(fields: [maSanPham], references: [maSanPham], onDelete: Cascade)
}