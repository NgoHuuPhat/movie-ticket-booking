
generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model LOAINGUOIDUNG {
  maLoaiNguoiDung  String @id
  tenLoaiNguoiDung String   
  moTa             String?  
  nguoiDungs       NGUOIDUNG[]
}

enum TRANGTHAINGUOIDUNG {
  HoatDong
  BiKhoa
} 
enum GIOITINH {
  Nam
  Nu
  Khac
}
model NGUOIDUNG {
  maNguoiDung   String  @id 
  hoTen         String           
  email         String  @unique
  matKhau       String           
  soDienThoai   String  @unique
  maLoaiNguoiDung String         
  ngaySinh      DateTime
  gioiTinh      GIOITINH        
  anhDaiDien    String?          
  trangThai     TRANGTHAINGUOIDUNG @default(HoatDong)       
  ngayTao       DateTime  @default(now())
  diemTichLuy   Int @default(0)

  loaiNguoiDung LOAINGUOIDUNG   @relation(fields: [maLoaiNguoiDung], references: [maLoaiNguoiDung], onDelete: Cascade, onUpdate: Cascade)
}

model THELOAI {
  maTheLoai String @id
  tenTheLoai String
  moTa       String?
  phimTheLoais PHIM_THELOAI[]
}

model PHIM_THELOAI {
  maPhim     String
  maTheLoai  String

  phim       PHIM      @relation(fields: [maPhim], references: [maPhim], onDelete: Cascade, onUpdate: Cascade)
  theLoai    THELOAI   @relation(fields: [maTheLoai], references: [maTheLoai], onDelete: Cascade, onUpdate: Cascade)

  @@id([maPhim, maTheLoai])
}

model PHANLOAIDOTUOI {
  maPhanLoaiDoTuoi String @id
  tenPhanLoaiDoTuoi String
  moTa              String
  phims             PHIM[]
}


enum PHIENBAN {
  TWO_D
  THREE_D 
}
enum NGONNGU {
  LongTieng 
  PhuDe
}
model PHIM {
  maPhim        String      @id
  tenPhim       String      
  daoDien       String
  dienVien      String
  thoiLuong     Int
  moTa          String
  anhBia        String      
  ngayKhoiChieu DateTime    
  ngayKetThuc   DateTime    
  maPhanLoaiDoTuoi String
  trailerPhim   String
  quocGia       String
  phienBan      PHIENBAN
  ngonNgu       NGONNGU
  hienThi       Boolean     @default(true)
  slug          String      @unique

  phanLoaiDoTuoi  PHANLOAIDOTUOI @relation(fields: [maPhanLoaiDoTuoi], references: [maPhanLoaiDoTuoi], onDelete: Cascade, onUpdate: Cascade)

  suatChieus    SUATCHIEU[]
  phimTheLoais  PHIM_THELOAI[]
}   

model RAP {
  maRap       String    @id
  tenRap      String
  diaChi      String
  soDienThoai String
  email       String    @unique
  trangThai   Boolean   @default(true)
  phongChieus PHONGCHIEU[]
}

model PHONGCHIEU {
  maPhong         String   @id
  tenPhong        String
  maLoaiPhong     String
  maRap           String

  loaiPhongChieu  LOAIPHONGCHIEU @relation(fields: [maLoaiPhong], references: [maLoaiPhong], onDelete: Cascade, onUpdate: Cascade)
  rap             RAP            @relation(fields: [maRap], references: [maRap], onDelete: Cascade, onUpdate: Cascade)

  suatChieus      SUATCHIEU[]
  ghes            GHE[]
}

model LOAIPHONGCHIEU {
  maLoaiPhong   String  @id
  tenLoaiPhong  String
  moTa          String?

  phongChieus   PHONGCHIEU[]
  giaGhePhongs  GIAGHEPHONG[]
}

model SUATCHIEU {
  maSuatChieu   String    @id
  maPhim        String
  maPhong       String
  ngayChieu     DateTime  @db.Date
  gioChieu      DateTime  @db.Time
  gioKetThuc    DateTime  @db.Time

  gheSuatChieus GHE_SUATCHIEU[]

  phim          PHIM        @relation(fields: [maPhim], references: [maPhim], onDelete: Cascade, onUpdate: Cascade)
  phongChieu    PHONGCHIEU  @relation(fields: [maPhong], references: [maPhong], onDelete: Cascade, onUpdate: Cascade)
}

model GIAGHEPHONG {
  maLoaiPhong   String  
  maLoaiGhe     String
  giaTien       Float   

  loaiGhe       LOAIGHE      @relation(fields: [maLoaiGhe], references: [maLoaiGhe], onDelete: Cascade, onUpdate: Cascade)
  loaiPhongChieu LOAIPHONGCHIEU @relation(fields: [maLoaiPhong], references: [maLoaiPhong], onDelete: Cascade, onUpdate: Cascade)

  @@id([maLoaiPhong, maLoaiGhe])
}

model LOAIGHE {
  maLoaiGhe   String  @id
  tenLoaiGhe  String
  moTa        String? 

  giaGhePhongs GIAGHEPHONG[]
  ghes         GHE[]
}

model GHE {
  maGhe       String  @id
  maPhong     String
  hangGhe     String
  soGhe       Int
  maLoaiGhe   String

  gheSuatChieus GHE_SUATCHIEU[]

  loaiGhe     LOAIGHE      @relation(fields: [maLoaiGhe], references: [maLoaiGhe], onDelete: Cascade, onUpdate: Cascade)
  phongChieu  PHONGCHIEU  @relation(fields: [maPhong], references: [maPhong], onDelete: Cascade, onUpdate: Cascade)
}


enum TRANGTHAIGHE {
  DangTrong
  KhongSuDung
  DangDuocChon
  DaDat
}

model GHE_SUATCHIEU {
  maGhe          String
  maSuatChieu    String
  trangThaiGhe   TRANGTHAIGHE @default(DangTrong)

  ghe            GHE         @relation(fields: [maGhe], references: [maGhe], onDelete: Cascade, onUpdate: Cascade)
  suatChieu      SUATCHIEU   @relation(fields: [maSuatChieu], references: [maSuatChieu], onDelete: Cascade, onUpdate: Cascade)

  @@id([maGhe, maSuatChieu])
}